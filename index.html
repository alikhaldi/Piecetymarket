<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Piecety - Auto Parts Marketplace</title>

  <!-- Favicon (embedded data URI to avoid mixed content) -->
  <link rel="icon" 
        href="data:image/svg+xml;utf8,
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
          <rect fill='%23007acc' width='64' height='64'/>
          <text x='32' y='42' font-size='32' text-anchor='middle' fill='white'>ðŸš—</text>
        </svg>">

  <!-- Use the CSS file you created in dist/ -->
  <link rel="stylesheet" href="dist/styles.css">

  <!-- FontAwesome icons -->
  <link rel="stylesheet" 
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="flex flex-col min-h-screen text-gray-800">

<!-- Notification box -->
<div id="message-box" class="message-box bg-white text-gray-800"></div>

<!-- HEADER -->
<header class="bg-white shadow-sm sticky top-0 z-50">
  <div class="container p-4 flex items-center justify-between">
    <a href="#" id="home-link" class="text-3xl font-bold text-blue-600">Piecety</a>

    <div class="flex-1 mx-4">
      <div class="relative">
        <input id="search-input" type="text" placeholder="Search for a part..."
               class="w-full p-3 pl-10 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 shadow-inner"/>
        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
      </div>
    </div>

    <nav class="hidden md:flex items-center space-x-6">
      <a href="#" id="sell-link" class="text-gray-600 hover:text-blue-600 font-medium">Sell</a>
      <button id="cart-btn" class="relative p-2 text-gray-600 hover:text-blue-600">
        <i class="fas fa-shopping-cart text-xl"></i>
        <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full hidden">0</span>
      </button>
      <button id="login-btn" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-full font-semibold">Login</button>
    </nav>

    <!-- Mobile menu button -->
    <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-600 hover:text-blue-600">
      <i class="fas fa-bars text-xl"></i>
    </button>
  </div>
</header>

<!-- MOBILE MENU -->
<div id="mobile-menu" class="fixed inset-0 bg-white z-40 hidden flex-col p-6 space-y-6 md:hidden">
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-bold text-blue-600">Menu</h2>
    <button id="mobile-menu-close-btn" class="text-gray-600 hover:text-blue-600">
      <i class="fas fa-times text-xl"></i>
    </button>
  </div>
  <a href="#" id="sell-link-mobile" class="text-xl font-medium text-gray-800 hover:text-blue-600">Sell</a>
  <button id="post-product-btn-mobile" class="text-xl font-medium text-gray-800 hover:text-blue-600 text-left">Login</button>
</div>

<!-- MAIN CONTENT -->
<main id="app-container" class="flex-1 container p-4">
  <!-- Products / views will be rendered here by JS -->
</main>

<!-- FOOTER -->
<footer class="bg-gray-800 text-white p-6 text-center mt-auto">
  <p class="text-sm">&copy; <span id="current-year"></span> Piecety - Auto Parts Marketplace. All rights reserved.</p>
</footer>

<!-- FIREBASE + APP SCRIPT -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import {
    getFirestore, collection, getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

  // Firebase config (from your project)
  const firebaseConfig = {
    apiKey: "AIzaSyBIptEskV2soajxRYPDfwYFYyz9pWQvZL0",
    authDomain: "piecety-app-b39c4.firebaseapp.com",
    projectId: "piecety-app-b39c4",
    storageBucket: "piecety-app-b39c4.appspot.com",
    messagingSenderId: "265795860915",
    appId: "1:265795860915:web:aa10241788cce42f6373c6"
  };

  // Init Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // DOM elements
  const appContainer = document.getElementById("app-container");
  const loginBtn = document.getElementById("login-btn");
  const cartCount = document.getElementById("cart-count");

  // Display products
  async function renderProducts() {
    appContainer.innerHTML = "<p>Loading products...</p>";
    const snapshot = await getDocs(collection(db, "products"));
    let html = "<div class='grid grid-cols-1 md:grid-cols-3 gap-4'>";
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `
        <div class="border rounded-lg p-4 shadow-sm">
          <h3 class="font-semibold text-lg">${data.name || "Unnamed"}</h3>
          <p class="text-gray-600">${data.price || "0"} DZD</p>
        </div>
      `;
    });
    html += "</div>";
    appContainer.innerHTML = html;
  }

  // Auth logic
  loginBtn.addEventListener("click", async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      alert("Logged in as " + result.user.displayName);
    } catch (err) {
      console.error(err);
      alert("Login failed");
    }
  });

  onAuthStateChanged(auth, user => {
    if (user) {
      loginBtn.textContent = "Logout";
      loginBtn.onclick = () => signOut(auth);
    } else {
      loginBtn.textContent = "Login";
    }
  });

  // Initialize
  renderProducts();
  document.getElementById("current-year").textContent = new Date().getFullYear();
</script>

</body>
</html>
