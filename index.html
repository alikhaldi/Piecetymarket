<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="Piecety - Votre marché fiable pour les pièces auto en Algérie" />
    <title>Piecety - Marché des Pièces Auto en Algérie</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Replace with local Tailwind CSS in production: https://tailwindcss.com/docs/installation -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="./car.svg" />
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Arabic', sans-serif;
            background-color: #f7fafc;
        }
        body.dark {
            background-color: #1a202c;
            color: #f7fafc;
        }
        body.dark .bg-white {
            background-color: #2d3748;
        }
        body.dark .text-gray-800 {
            color: #f7fafc;
        }
        body.dark .text-gray-600 {
            color: #a0aec0;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: translateX(100%);
            max-width: 300px;
            word-wrap: break-word;
        }
        .message-box.show {
            opacity: 1;
            transform: translateX(0);
        }
        .category-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .category-card:hover .category-icon {
            transform: scale(1.1);
            background-color: #bfdbfe;
        }
        body[dir="rtl"] .logo {
            text-align: right;
        }
        body[dir="rtl"] .flex-1.mx-4.sm\:mx-8 {
            margin-right: 0.5rem;
            margin-left: 0.5rem;
        }
        body[dir="rtl"] .fa-search {
            right: 3px;
            left: auto;
        }
        .hero-section {
            background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cpath d="M11 18c3.5 0 6.5 4 6.5 9 0 5-3 9-6.5 9s-6.5-4-6.5-9c0-5 3-9 6.5-9zm40 40c3.5 0 6.5 4 6.5 9 0 5-3 9-6.5 9s-6.5-4-6.5-9c0-5 3-9 6.5-9zm40-40c3.5 0 6.5 4 6.5 9 0 5-3 9-6.5 9s-6.5-4-6.5-9c0-5 3-9 6.5-9z" fill="%23ffffff" opacity="0.1"/%3E%3C/svg%3E');
            position: relative;
        }
        .hero-search {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
        }
        [role="button"], button, a, input, select, textarea {
            focus-visible: outline-none;
            focus-visible: ring-2 ring-blue-500;
        }
        .product-description, textarea {
            line-height: 1.5;
        }
        .modal {
            transition: all 0.3s ease;
        }
        .modal.hidden {
            opacity: 0;
            transform: scale(0.95);
        }
        .icon-btn {
            padding: 0.75rem;
            min-width: 44px;
            min-height: 44px;
        }
        img {
            background: url('https://placehold.co/20x20/E2E8F0/4A5568?text=...') center/cover;
        }
        .category-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">
    <div id="message-box" class="message-box bg-white text-gray-800"></div>
    <header class="bg-white shadow-sm sticky top-0 z-50" role="banner">
        <div class="container mx-auto p-4 flex items-center justify-between">
            <a href="#" id="home-link" class="flex items-center text-2xl md:text-3xl font-bold text-blue-600 logo transition-transform hover:scale-105">
                <img src="./car.svg" class="h-8 mr-2" alt="Piecety Logo" /> Piecety
            </a>
            <div class="flex-1 mx-4 sm:mx-8">
                <div class="relative">
                    <input id="search-input" type="text" placeholder="Rechercher une pièce..." class="w-full p-3 pl-10 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 shadow-inner" aria-label="Rechercher une pièce" />
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            <nav class="hidden md:flex items-center space-x-6" role="navigation" aria-label="Main navigation">
                <div class="relative group">
                    <button id="lang-dropdown-btn" aria-haspopup="true" aria-expanded="false" class="flex items-center space-x-1 font-medium text-gray-600 hover:text-blue-600 transition-colors duration-200">
                        <span id="current-lang" class="lang-text">FR</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div id="lang-dropdown" class="absolute right-0 mt-2 w-28 bg-white rounded-lg shadow-lg py-1 hidden transition-all duration-300 z-10" role="menu" aria-label="Select Language">
                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 lang-btn" data-lang="fr" role="menuitem">Français</button>
                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 lang-btn" data-lang="en" role="menuitem">English</button>
                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 lang-btn" data-lang="ar" role="menuitem">العربية</button>
                        <button id="dark-mode-toggle" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600" role="menuitem">Dark Mode</button>
                    </div>
                </div>
                <a href="#" class="text-gray-600 hover:text-blue-600 font-medium transition-colors duration-200" data-i18n-key="sell" id="sell-link">Vendre</a>
                <button id="cart-btn" class="relative icon-btn text-gray-600 hover:text-blue-600 focus:outline-none" aria-label="Panier">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full hidden">0</span>
                </button>
                <div id="auth-links" class="flex items-center space-x-4">
                    <button id="login-btn" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-full font-semibold transition-colors duration-200 shadow-md icon-btn" data-i18n-key="connect">Se connecter</button>
                </div>
            </nav>
            <button id="mobile-menu-btn" class="md:hidden icon-btn text-gray-600 hover:text-blue-600 focus:outline-none" aria-label="Menu" aria-expanded="false" aria-controls="mobile-menu">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </header>
    <div id="mobile-menu" class="fixed inset-0 bg-white z-40 hidden flex-col p-6 space-y-6 md:hidden modal" role="dialog" aria-modal="true" aria-labelledby="mobile-menu-label">
        <div class="flex justify-between items-center">
            <h2 id="mobile-menu-label" class="text-2xl font-bold text-blue-600" data-i18n-key="menu">Menu</h2>
            <button id="mobile-menu-close-btn" class="icon-btn text-gray-600 hover:text-blue-600" aria-label="Fermer menu">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="mobile-nav-links" class="flex flex-col space-y-6"></div>
        <div class="pt-4 border-t border-gray-200">
            <h3 class="text-lg font-semibold text-gray-600" data-i18n-key="language">Langue</h3>
            <div class="flex space-x-4 mt-2">
                <button class="p-2 border rounded-md text-sm font-medium lang-btn icon-btn" data-lang="fr">Français</button>
                <button class="p-2 border rounded-md text-sm font-medium lang-btn icon-btn" data-lang="en">English</button>
                <button class="p-2 border rounded-md text-sm font-medium lang-btn icon-btn" data-lang="ar">العربية</button>
                <button id="mobile-dark-mode-toggle" class="p-2 border rounded-md text-sm font-medium icon-btn">Dark Mode</button>
            </div>
        </div>
    </div>
    <main id="app-container" class="flex-1 container mx-auto p-4 md:p-8" role="main" aria-live="polite">
        <aside id="filters-sidebar" class="hidden md:block md:w-1/4 p-4 bg-white rounded-lg shadow-md mb-4 md:mb-0">
            <h3 class="text-lg font-semibold mb-4" data-i18n-key="filters">Filtres</h3>
            <div class="space-y-4">
                <div>
                    <label for="filter-price" class="block font-medium mb-1" data-i18n-key="price_range">Plage de prix (DA)</label>
                    <input type="range" id="filter-price" min="0" max="100000" value="100000" class="w-full" />
                    <span id="filter-price-value" class="text-sm text-gray-600">0 - 100,000 DA</span>
                </div>
                <div>
                    <label for="filter-category" class="block font-medium mb-1" data-i18n-key="category_label">Catégorie</label>
                    <select id="filter-category" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="" data-i18n-key="select_category">Toutes les catégories</option>
                        <option value="engine" data-i18n-key="category_engine">Moteur</option>
                        <option value="brakes" data-i18n-key="category_brakes">Freins</option>
                        <option value="fuel_system" data-i18n-key="category_fuel_system">Système de carburant</option>
                        <option value="cooling" data-i18n-key="category_cooling">Refroidissement</option>
                        <option value="tires" data-i18n-key="category_tires">Pneus & Jantes</option>
                        <option value="electrical" data-i18n-key="category_electrical">Électrique</option>
                    </select>
                </div>
            </div>
            <button id="filter-toggle-mobile" class="md:hidden mt-4 px-4 py-2 bg-blue-600 text-white rounded-full font-semibold icon-btn" data-i18n-key="filters">Filtres</button>
        </aside>
        <div id="content-container" class="md:w-3/4 md:pl-4"></div>
    </main>
    <footer class="bg-gray-800 text-white p-6 md:p-8 mt-auto text-center">
        <p class="text-sm font-light">
            &copy; <span id="current-year"></span> Piecety - Marché des Pièces Auto en Algérie. <br>
            <span class="text-xs" data-i18n-key="footer_location_text">Fièrement au service de Hassi R'Mel et de toute l'Algérie.</span>
        </p>
        <div class="mt-4 flex justify-center space-x-4">
            <a href="https://facebook.com" target="_blank" class="text-white hover:text-blue-400 icon-btn" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://instagram.com" target="_blank" class="text-white hover:text-blue-400 icon-btn" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#contact" class="text-white hover:text-blue-400 icon-btn" data-i18n-key="contact_us" aria-label="Contactez-nous">Contactez-nous</a>
        </div>
    </footer>
    <div id="post-product-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden p-4 modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] flex flex-col overflow-y-auto">
            <div class="p-6 relative">
                <button id="modal-close-btn" class="absolute top-4 right-4 icon-btn text-gray-600 hover:text-red-600 focus:outline-none" aria-label="Fermer le formulaire">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                <h3 id="modal-title" class="text-2xl font-bold mb-6 text-center" data-i18n-key="submit_ad">Soumettre une annonce rapide</h3>
                <form id="post-product-form" class="space-y-4" novalidate>
                    <div>
                        <label for="product-title" class="block font-medium mb-1" data-i18n-key="ad_title_label">Titre de la pièce <span class="text-red-500">*</span></label>
                        <input type="text" id="product-title" name="title" required placeholder="Ex: Disque de frein avant" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-describedby="title-error" />
                        <p id="title-error" class="text-red-600 text-sm mt-1 hidden" aria-live="assertive">Veuillez entrer un titre valide.</p>
                    </div>
                    <div>
                        <label for="product-category" class="block font-medium mb-1" data-i18n-key="category_label">Catégorie <span class="text-red-500">*</span></label>
                        <select id="product-category" name="category" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-describedby="category-error">
                            <option value="" data-i18n-key="select_category">Sélectionnez une catégorie</option>
                            <option value="engine" data-i18n-key="category_engine">Moteur</option>
                            <option value="brakes" data-i18n-key="category_brakes">Freins</option>
                            <option value="fuel_system" data-i18n-key="category_fuel_system">Système de carburant</option>
                            <option value="cooling" data-i18n-key="category_cooling">Refroidissement</option>
                            <option value="tires" data-i18n-key="category_tires">Pneus & Jantes</option>
                            <option value="electrical" data-i18n-key="category_electrical">Électrique</option>
                        </select>
                        <p id="category-error" class="text-red-600 text-sm mt-1 hidden" aria-live="assertive">Veuillez sélectionner une catégorie.</p>
                    </div>
                    <div>
                        <label for="product-brand" class="block font-medium mb-1" data-i18n-key="brand_label">Marque <span class="text-red-500">*</span></label>
                        <select id="product-brand" name="brand" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-describedby="brand-error">
                            <option value="" data-i18n-key="select_brand">Sélectionnez une marque</option>
                        </select>
                        <p id="brand-error" class="text-red-600 text-sm mt-1 hidden" aria-live="assertive">Veuillez sélectionner une marque.</p>
                    </div>
                    <div>
                        <label for="product-model" class="block font-medium mb-1" data-i18n-key="model_label">Modèle</label>
                        <select id="product-model" name="model" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                            <option value="" data-i18n-key="select_model">Sélectionnez un modèle</option>
                        </select>
                    </div>
                    <div>
                        <label for="product-year" class="block font-medium mb-1" data-i18n-key="year_label">Année</label>
                        <select id="product-year" name="year" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-i18n-key="select_year">Sélectionnez une année</option>
                        </select>
                    </div>
                    <div>
                        <label for="product-wilaya" class="block font-medium mb-1" data-i18n-key="wilaya_label">Wilaya <span class="text-red-500">*</span></label>
                        <select id="product-wilaya" name="wilaya" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-describedby="wilaya-error">
                            <option value="" data-i18n-key="select_wilaya">Sélectionnez une wilaya</option>
                        </select>
                        <p id="wilaya-error" class="text-red-600 text-sm mt-1 hidden" aria-live="assertive">Veuillez sélectionner une wilaya.</p>
                    </div>
                    <div>
                        <label for="product-commune" class="block font-medium mb-1" data-i18n-key="commune_label">Commune</label>
                        <select id="product-commune" name="commune" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                            <option value="" data-i18n-key="select_commune">Sélectionnez une commune</option>
                        </select>
                    </div>
                    <div>
                        <label for="product-condition" class="block font-medium mb-1" data-i18n-key="condition_label">État</label>
                        <select id="product-condition" name="condition" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="new" data-i18n-key="new">Neuf</option>
                            <option value="used" data-i18n-key="used">Occasion</option>
                        </select>
                    </div>
                    <div>
                        <label for="product-price" class="block font-medium mb-1" data-i18n-key="price_label">Prix (DA) <span class="text-red-500">*</span></label>
                        <input type="number" id="product-price" name="price" min="0" required placeholder="Ex: 15000" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-describedby="price-error" />
                        <p id="price-error" class="text-red-600 text-sm mt-1 hidden" aria-live="assertive">Veuillez entrer un prix valide.</p>
                    </div>
                    <div>
                        <label for="product-description" class="block font-medium mb-1" data-i18n-key="description_label">Description</label>
                        <textarea id="product-description" name="description" rows="3" placeholder="Informations supplémentaires..." class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none product-description"></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" id="submit-ad-btn" class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-full font-semibold hover:bg-blue-700 transition-colors duration-200 shadow-md flex items-center justify-center disabled:bg-blue-400 disabled:cursor-not-allowed icon-btn" data-i18n-key="submit_ad_btn_text">
                            <span class="btn-text">Soumettre</span>
                            <svg class="animate-spin ml-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title">
        <div class="bg-white rounded-lg shadow-lg max-w-sm w-full p-6 relative">
            <button id="auth-modal-close-btn" class="absolute top-4 right-4 icon-btn text-gray-600 hover:text-red-600 focus:outline-none" aria-label="Fermer le formulaire de connexion">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <h3 id="auth-modal-title" class="text-2xl font-bold mb-6 text-center" data-i18n-key="connect">Se connecter</h3>
            <div class="space-y-4">
                <p class="text-center text-gray-600" data-i18n-key="login_text">Connectez-vous pour accéder à toutes les fonctionnalités.</p>
                <button id="google-login-btn" class="w-full flex items-center justify-center px-4 py-3 bg-white border border-gray-300 rounded-full text-gray-700 font-semibold hover:bg-gray-100 transition-colors duration-200 shadow-sm icon-btn">
                    <i class="fab fa-google text-xl mr-2"></i>
                    <span data-i18n-key="google_login">Se connecter avec Google</span>
                </button>
            </div>
        </div>
    </div>
    <div id="filter-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden modal md:hidden" role="dialog" aria-modal="true" aria-labelledby="filter-modal-title">
        <div class="bg-white rounded-lg shadow-lg max-w-sm w-full p-6 relative">
            <button id="filter-modal-close-btn" class="absolute top-4 right-4 icon-btn text-gray-600 hover:text-red-600 focus:outline-none" aria-label="Fermer les filtres">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <h3 id="filter-modal-title" class="text-2xl font-bold mb-6 text-center" data-i18n-key="filters">Filtres</h3>
            <div class="space-y-4">
                <div>
                    <label for="filter-price-mobile" class="block font-medium mb-1" data-i18n-key="price_range">Plage de prix (DA)</label>
                    <input type="range" id="filter-price-mobile" min="0" max="100000" value="100000" class="w-full" />
                    <span id="filter-price-value-mobile" class="text-sm text-gray-600">0 - 100,000 DA</span>
                </div>
                <div>
                    <label for="filter-category-mobile" class="block font-medium mb-1" data-i18n-key="category_label">Catégorie</label>
                    <select id="filter-category-mobile" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="" data-i18n-key="select_category">Toutes les catégories</option>
                        <option value="engine" data-i18n-key="category_engine">Moteur</option>
                        <option value="brakes" data-i18n-key="category_brakes">Freins</option>
                        <option value="fuel_system" data-i18n-key="category_fuel_system">Système de carburant</option>
                        <option value="cooling" data-i18n-key="category_cooling">Refroidissement</option>
                        <option value="tires" data-i18n-key="category_tires">Pneus & Jantes</option>
                        <option value="electrical" data-i18n-key="category_electrical">Électrique</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <template id="home-view-template">
        <section class="text-center py-8 md:py-24 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl shadow-lg mb-8 md:mb-12 h-48 md:h-64 hero-section">
            <h1 class="text-2xl sm:text-3xl md:text-5xl font-extrabold mb-4" data-i18n-key="hero_title">Trouvez la bonne pièce pour votre voiture</h1>
            <p class="text-base sm:text-lg md:text-xl font-light mb-8" data-i18n-key="hero_subtitle">Le marché algérien des pièces automobiles le plus fiable.</p>
            <div class="hero-search relative hidden md:block">
                <input id="hero-search-input" type="text" placeholder="Rechercher une pièce..." class="w-full p-3 pl-10 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 shadow-inner" aria-label="Rechercher une pièce" />
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </section>
        <section class="mb-8 md:mb-12" aria-label="Catégories de pièces">
            <h2 class="text-2xl md:text-4xl font-bold mb-6 text-center" data-i18n-key="categories_title">Catégories de Pièces</h2>
            <div class="category-row grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-cogs text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_engine">Moteur</h3>
                </a>
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-car text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_brakes">Freins</h3>
                </a>
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-gas-pump text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_fuel_system">Système de carburant</h3>
                </a>
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-fan text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_cooling">Refroidissement</h3>
                </a>
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-circle text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_tires">Pneus & Jantes</h3>
                </a>
                <a href="#" class="bg-white rounded-xl shadow-md p-4 text-center category-card">
                    <div class="p-4 rounded-full bg-blue-100 text-blue-600 mx-auto w-16 h-16 flex items-center justify-center mb-2 transition-transform duration-300 category-icon">
                        <i class="fas fa-bolt text-3xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg" data-i18n-key="category_electrical">Électrique</h3>
                </a>
            </div>
        </section>
    </template>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
    <script>
        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "piecety-app-b39c4.firebaseapp.com",
            projectId: "piecety-app-b39c4",
            storageBucket: "piecety-app-b39c4.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        db.enablePersistence().catch(err => console.error("Offline persistence error:", err));
        const provider = new firebase.auth.GoogleAuthProvider();
        let currentUser = null;
        let userCart = {};
        let userFavorites = [];
        let currentLang = localStorage.getItem('piecety_lang') || 'fr';
        let currentView = 'home';
        let allProducts = [];
        const currentYear = new Date().getFullYear();
        const translations = {
            fr: {
                hero_title: "Trouvez la bonne pièce pour votre voiture",
                hero_subtitle: "Le marché algérien des pièces automobiles le plus fiable.",
                categories_title: "Catégories de Pièces",
                category_engine: "Moteur",
                category_brakes: "Freins",
                category_fuel_system: "Système de carburant",
                category_cooling: "Refroidissement",
                category_tires: "Pneus & Jantes",
                category_electrical: "Électrique",
                sell: "Vendre",
                connect: "Se connecter",
                menu: "Menu",
                language: "Langue",
                footer_location_text: "Fièrement au service de Hassi R'Mel et de toute l'Algérie.",
                submit_ad: "Soumettre une annonce rapide",
                ad_title_label: "Titre de la pièce",
                category_label: "Catégorie",
                select_category: "Sélectionnez une catégorie",
                brand_label: "Marque",
                select_brand: "Sélectionnez une marque",
                model_label: "Modèle",
                select_model: "Sélectionnez un modèle",
                year_label: "Année",
                select_year: "Sélectionnez une année",
                wilaya_label: "Wilaya",
                select_wilaya: "Sélectionnez une wilaya",
                commune_label: "Commune",
                select_commune: "Sélectionnez une commune",
                condition_label: "État",
                new: "Neuf",
                used: "Occasion",
                price_label: "Prix (DA)",
                description_label: "Description",
                submit_ad_btn_text: "Soumettre",
                login_text: "Connectez-vous pour accéder à toutes les fonctionnalités.",
                google_login: "Se connecter avec Google",
                filters: "Filtres",
                price_range: "Plage de prix (DA)",
                dashboard_link_mobile: "Mon Tableau de Bord",
                login_required: "Connexion requise pour accéder à cette fonctionnalité.",
                your_cart_is_empty: "Votre panier est vide.",
                quantity: "Quantité",
                item_total: "Total de l'article",
                remove: "Supprimer",
                loading_text: "Envoi...",
                contact_us: "Contactez-nous",
                add_to_cart: "Ajouter au panier",
                contact_seller: "Contacter le vendeur",
                clear_cart: "Vider le panier",
                checkout: "Paiement",
                no_products: "Aucune annonce disponible.",
                image_load_error: "Impossible de charger l'image."
            },
            en: {
                hero_title: "Find the right part for your car",
                hero_subtitle: "The most reliable Algerian auto parts marketplace.",
                categories_title: "Parts Categories",
                category_engine: "Engine",
                category_brakes: "Brakes",
                category_fuel_system: "Fuel System",
                category_cooling: "Cooling",
                category_tires: "Tires & Rims",
                category_electrical: "Electrical",
                sell: "Sell",
                connect: "Log In",
                menu: "Menu",
                language: "Language",
                footer_location_text: "Proudly serving Hassi R'Mel and all of Algeria.",
                submit_ad: "Submit a Quick Ad",
                ad_title_label: "Part Title",
                category_label: "Category",
                select_category: "Select a category",
                brand_label: "Brand",
                select_brand: "Select a brand",
                model_label: "Model",
                select_model: "Select a model",
                year_label: "Year",
                select_year: "Select a year",
                wilaya_label: "Wilaya",
                select_wilaya: "Select a wilaya",
                commune_label: "Commune",
                select_commune: "Select a commune",
                condition_label: "Condition",
                new: "New",
                used: "Used",
                price_label: "Price (DA)",
                description_label: "Description",
                submit_ad_btn_text: "Submit",
                login_text: "Log in to access all features.",
                google_login: "Log in with Google",
                filters: "Filters",
                price_range: "Price Range (DA)",
                dashboard_link_mobile: "My Dashboard",
                login_required: "Login required to access this feature.",
                your_cart_is_empty: "Your cart is empty.",
                quantity: "Quantity",
                item_total: "Item Total",
                remove: "Remove",
                loading_text: "Submitting...",
                contact_us: "Contact Us",
                add_to_cart: "Add to Cart",
                contact_seller: "Contact Seller",
                clear_cart: "Clear Cart",
                checkout: "Checkout",
                no_products: "No listings available.",
                image_load_error: "Unable to load image."
            },
            ar: {
                hero_title: "ابحث عن القطعة المناسبة لسيارتك",
                hero_subtitle: "السوق الأكثر موثوقية لقطع غيار السيارات في الجزائر.",
                categories_title: "فئات القطع",
                category_engine: "المحرك",
                category_brakes: "الفرامل",
                category_fuel_system: "نظام الوقود",
                category_cooling: "التبريد",
                category_tires: "الإطارات والجنوط",
                category_electrical: "الكهربائية",
                sell: "بيع",
                connect: "تسجيل الدخول",
                menu: "القائمة",
                language: "اللغة",
                footer_location_text: "نخدم بفخر حاسي الرمل وكل الجزائر.",
                submit_ad: "إرسال إعلان سريع",
                ad_title_label: "عنوان القطعة",
                category_label: "الفئة",
                select_category: "اختر فئة",
                brand_label: "العلامة التجارية",
                select_brand: "اختر علامة تجارية",
                model_label: "الطراز",
                select_model: "اختر طرازًا",
                year_label: "السنة",
                select_year: "اختر سنة",
                wilaya_label: "الولاية",
                select_wilaya: "اختر ولاية",
                commune_label: "البلدية",
                select_commune: "اختر بلدية",
                condition_label: "الحالة",
                new: "جديد",
                used: "مستعمل",
                price_label: "السعر (دج)",
                description_label: "الوصف",
                submit_ad_btn_text: "إرسال",
                login_text: "تسجيل الدخول للوصول إلى جميع الميزات.",
                google_login: "تسجيل الدخول باستخدام جوجل",
                filters: "الفلاتر",
                price_range: "نطاق السعر (دج)",
                dashboard_link_mobile: "لوحة التحكم الخاصة بي",
                login_required: "تسجيل الدخول مطلوب للوصول إلى هذه الميزة.",
                your_cart_is_empty: "سلة التسوق الخاصة بك فارغة.",
                quantity: "الكمية",
                item_total: "إجمالي العنصر",
                remove: "إزالة",
                loading_text: "جارٍ الإرسال...",
                contact_us: "اتصل بنا",
                add_to_cart: "إضافة إلى السلة",
                contact_seller: "الاتصال بالبائع",
                clear_cart: "إفراغ السلة",
                checkout: "الدفع",
                no_products: "لا توجد إعلانات متاحة.",
                image_load_error: "غير قادر على تحميل الصورة."
            }
        };
        const car_data = {
            Toyota: ["Yaris", "Corolla", "Hilux"],
            Peugeot: ["308", "206", "407"],
            Renault: ["Clio", "Megane", "Duster"]
        };
        const years = Array.from({ length: 50 }, (_, i) => (new Date().getFullYear() - i).toString());
        const wilayas = {
            Alger: ["Bab El Oued", "El Harrach", "Hussein Dey"],
            Oran: ["Es Senia", "Bir El Djir"],
            Constantine: ["El Khroub", "Ain Smara"]
        };
        const elements = {
            messageBox: document.getElementById('message-box'),
            langDropdownBtn: document.getElementById('lang-dropdown-btn'),
            langDropdown: document.getElementById('lang-dropdown'),
            langBtns: document.querySelectorAll('.lang-btn'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mobileMenu: document.getElementById('mobile-menu'),
            mobileMenuCloseBtn: document.getElementById('mobile-menu-close-btn'),
            mobileNavLinks: document.getElementById('mobile-nav-links'),
            modalCloseBtn: document.getElementById('modal-close-btn'),
            postProductModal: document.getElementById('post-product-modal'),
            postProductForm: document.getElementById('post-product-form'),
            loginBtn: document.getElementById('login-btn'),
            homeLink: document.getElementById('home-link'),
            cartBtn: document.getElementById('cart-btn'),
            authModalCloseBtn: document.getElementById('auth-modal-close-btn'),
            googleLoginBtn: document.getElementById('google-login-btn'),
            authLinksContainer: document.getElementById('auth-links'),
            sellLink: document.getElementById('sell-link'),
            postProductBrandSelect: document.getElementById('product-brand'),
            postProductModelSelect: document.getElementById('product-model'),
            postProductYearSelect: document.getElementById('product-year'),
            postProductWilayaSelect: document.getElementById('product-wilaya'),
            postProductCommuneSelect: document.getElementById('product-commune'),
            filterToggleMobile: document.getElementById('filter-toggle-mobile'),
            filterModal: document.getElementById('filter-modal'),
            filterModalCloseBtn: document.getElementById('filter-modal-close-btn'),
            filterPrice: document.getElementById('filter-price'),
            filterPriceValue: document.getElementById('filter-price-value'),
            filterPriceMobile: document.getElementById('filter-price-mobile'),
            filterPriceValueMobile: document.getElementById('filter-price-value-mobile'),
            filterCategory: document.getElementById('filter-category'),
            filterCategoryMobile: document.getElementById('filter-category-mobile'),
            searchInput: document.getElementById('search-input'),
            heroSearchInput: document.getElementById('hero-search-input')
        };
        const showMessage = (msg, duration = 3500, type = "info", errorCode = null) => {
            if (!elements.messageBox) return;
            let displayMsg = msg;
            if (errorCode) {
                displayMsg = translations[currentLang].image_load_error || "Impossible de charger l'image.";
            }
            elements.messageBox.textContent = displayMsg;
            elements.messageBox.className = `message-box shadow-lg px-4 py-2 rounded-lg show ${type === "error" ? "bg-red-100 text-red-800" : type === "success" ? "bg-green-100 text-green-800" : "bg-white text-gray-800"}`;
            setTimeout(() => elements.messageBox.classList.remove("show"), duration);
        };
        const translatePage = (lang) => {
            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.dataset.i18nKey;
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            elements.searchInput.placeholder = translations[lang].search_placeholder || "Rechercher une pièce...";
            if (elements.heroSearchInput) {
                elements.heroSearchInput.placeholder = translations[lang].search_placeholder || "Rechercher une pièce...";
            }
        };
        const populateSelect = (select, options, defaultKey, lang) => {
            if (!select) return;
            select.innerHTML = `<option value="" data-i18n-key="${defaultKey}">${translations[lang][defaultKey]}</option>`;
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
        };
        const closeMobileMenu = () => {
            elements.mobileMenu.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        };
        const openAuthModal = () => {
            elements.authModal.classList.remove('hidden');
        };
        const closeAuthModal = () => {
            elements.authModal.classList.add('hidden');
        };
        const openFilterModal = () => {
            elements.filterModal.classList.remove('hidden');
        };
        const closeFilterModal = () => {
            elements.filterModal.classList.add('hidden');
        };
        const postProductBtnClick = () => {
            if (!currentUser || currentUser.isAnonymous) {
                showMessage(translations[currentLang].login_required, 4000, 'error');
                openAuthModal();
                return;
            }
            elements.postProductModal.classList.remove('hidden');
        };
        const updateCartDisplay = () => {
            const cartCountEl = document.getElementById('cart-count');
            const count = Object.values(userCart).reduce((sum, item) => sum + item.quantity, 0);
            if (count > 0) {
                cartCountEl.textContent = count;
                cartCountEl.classList.remove('hidden');
            } else {
                cartCountEl.classList.add('hidden');
            }
        };
        const debounce = (func, wait) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        };
        const updateURLParams = () => {
            const params = new URLSearchParams();
            if (elements.filterPrice.value !== '100000') {
                params.set('price', elements.filterPrice.value);
            }
            if (elements.filterCategory.value) {
                params.set('category', elements.filterCategory.value);
            }
            if (elements.searchInput.value) {
                params.set('search', elements.searchInput.value);
            }
            window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
        };
        const applyFilters = () => {
            const maxPrice = parseInt(elements.filterPrice.value);
            const category = elements.filterCategory.value;
            const search = elements.searchInput.value.toLowerCase();
            const filteredProducts = allProducts.filter(product => {
                return (!search || product.title.toLowerCase().includes(search)) &&
                       (!category || product.category === category) &&
                       (product.price <= maxPrice);
            });
            const grid = document.getElementById('listings-grid');
            if (grid) {
                displayProducts(filteredProducts, grid);
            }
        };
        const renderView = async (view, data) => {
            const container = document.getElementById('content-container');
            if (!container) return;
            currentView = view;
            document.title = `Piecety - ${view.charAt(0).toUpperCase() + view.slice(1)}`;
            container.innerHTML = '';
            try {
                if (view === 'home') {
                    const template = document.getElementById('home-view-template').content.cloneNode(true);
                    container.appendChild(template);
                    await renderListings();
                } else if (view === 'cart') {
                    await renderCartPage();
                } else if (view === 'dashboard') {
                    await renderDashboardPage();
                } else if (view === 'profile') {
                    await renderProfilePage(data);
                } else if (view === 'product') {
                    await renderProductPage(data);
                }
            } catch (error) {
                showMessage("Erreur lors du rendu de la page.", 3000, 'error');
                console.error("Render error:", error);
            }
            translatePage(currentLang);
        };
        const renderListings = async () => {
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4';
            grid.id = 'listings-grid';
            const container = document.getElementById('content-container');
            container.appendChild(grid);
            try {
                db.collection('products').onSnapshot(snapshot => {
                    allProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    applyFilters();
                });
            } catch (error) {
                showMessage("Erreur lors du chargement des annonces.", 3000, 'error');
                console.error("Error fetching listings:", error);
            }
        };
        const displayProducts = (products, grid) => {
            grid.innerHTML = '';
            if (products.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center py-6 text-gray-500">${translations[currentLang].no_products}</p>`;
                return;
            }
            products.forEach(item => {
                const conditionBadge = item.condition === 'new' ? `<span class="absolute top-2 right-2 bg-green-100 text-green-800 px-2 py-1 rounded">${translations[currentLang].new}</span>` : `<span class="absolute top-2 right-2 bg-yellow-100 text-yellow-800 px-2 py-1 rounded">${translations[currentLang].used}</span>`;
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden flex flex-col min-h-[200px]';
                card.innerHTML = `
                    <div class="relative">
                        <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-48 object-cover" loading="lazy" srcset="${item.imageUrl} 600w, ${item.imageUrl.replace('600x400', '300x200')} 300w" sizes="(max-width: 600px) 300px, 600px" onerror="this.src='https://placehold.co/300x200/E2E8F0/4A5568?text=Image+Indisponible';" />
                        ${conditionBadge}
                    </div>
                    <div class="p-4 flex-1 flex flex-col">
                        <h3 class="font-semibold text-lg mb-1">${item.title}</h3>
                        <p class="text-blue-600 font-bold text-lg mt-auto pt-2">${item.price.toLocaleString()} DA</p>
                        <button class="mt-2 favorite-btn icon-btn text-gray-600 hover:text-red-600" data-product-id="${item.id}" aria-label="Ajouter aux favoris"><i class="fas fa-heart"></i></button>
                    </div>
                `;
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.favorite-btn')) {
                        renderView('product', item);
                    }
                });
                grid.appendChild(card);
            });
            grid.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    if (!currentUser) {
                        showMessage(translations[currentLang].login_required, 4000, 'error');
                        openAuthModal();
                        return;
                    }
                    const productId = e.currentTarget.dataset.productId;
                    await addToFavorites(productId);
                });
            });
            translatePage(currentLang);
        };
        const renderProductPage = async (product) => {
            if (!product) return;
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <button id="back-to-listings-btn" class="mb-4 text-blue-600 hover:text-blue-800 flex items-center icon-btn"><i class="fas fa-arrow-left mr-2"></i> Retour</button>
                    <div class="flex flex-col md:flex-row gap-6">
                        <img id="product-image-detail" src="${product.imageUrl}" alt="${product.title}" class="w-full md:w-1/2 h-64 object-cover rounded-lg" loading="lazy" srcset="${product.imageUrl} 600w, ${product.imageUrl.replace('600x400', '300x200')} 300w" sizes="(max-width: 600px) 300px, 600px" onerror="this.src='https://placehold.co/600x400/E2E8F0/4A5568?text=Image+Indisponible';" />
                        <div class="flex-1">
                            <h2 id="product-title-detail" class="text-2xl font-bold mb-2">${product.title}</h2>
                            <p id="product-price-detail" class="text-blue-600 font-bold text-xl mb-4">${product.price.toLocaleString()} DA</p>
                            <p id="product-description-detail" class="text-gray-600 mb-4 product-description">${product.description}</p>
                            <p><strong>${translations[currentLang].brand_label}:</strong> <span id="product-brand-detail">${product.brand}</span></p>
                            <p><strong>${translations[currentLang].model_label}:</strong> <span id="product-model-detail">${product.model || "-"}</span></p>
                            <p><strong>${translations[currentLang].year_label}:</strong> <span id="product-year-detail">${product.year || "-"}</span></p>
                            <p><strong>${translations[currentLang].wilaya_label}:</strong> <span id="product-wilaya-detail">${product.wilaya}</span></p>
                            <p><strong>${translations[currentLang].commune_label}:</strong> <span id="product-commune-detail">${product.commune || "-"}</span></p>
                            <p><strong>Vendeur:</strong> <a href="#" id="seller-profile-link" class="text-blue-600 hover:underline">${product.sellerName || 'Vendeur Anonyme'}</a></p>
                            <div class="mt-4 flex space-x-4">
                                <button id="add-to-cart-btn" class="px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 icon-btn">${translations[currentLang].add_to_cart}</button>
                                <button id="contact-seller-btn" class="px-4 py-2 bg-gray-600 text-white rounded-full hover:bg-gray-700 icon-btn" disabled>${translations[currentLang].contact_seller}</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            try {
                document.getElementById('seller-profile-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    renderView('profile', { userId: product.sellerUid, userName: product.sellerName });
                });
                document.getElementById('back-to-listings-btn').addEventListener('click', () => renderView('home'));
                document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                    if (!currentUser || currentUser.isAnonymous) {
                        showMessage(translations[currentLang].login_required, 4000, 'error');
                        openAuthModal();
                        return;
                    }
                    addToCart(product);
                });
                const contactBtn = document.getElementById('contact-seller-btn');
                if (currentUser) {
                    contactBtn.disabled = false;
                    contactBtn.addEventListener('click', () => {
                        showMessage("La messagerie directe sera bientôt disponible!", 3000, "info");
                    });
                }
            } catch (error) {
                showMessage("Erreur lors du rendu du produit.", 3000, 'error');
                console.error("Product page error:", error);
            }
            translatePage(currentLang);
        };
        const renderCartPage = async () => {
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <button id="back-from-cart-btn" class="mb-4 text-blue-600 hover:text-blue-800 flex items-center icon-btn"><i class="fas fa-arrow-left mr-2"></i> Retour</button>
                    <h2 class="text-2xl font-bold mb-6">${translations[currentLang].cart}</h2>
                    <div id="cart-items-container" class="space-y-4"></div>
                    <div class="mt-6 flex justify-between items-center">
                        <p class="text-lg font-bold"><span data-i18n-key="total">${translations[currentLang].total}</span>: <span id="cart-total-price">0 DA</span></p>
                        <div class="flex space-x-4">
                            <button id="clear-cart-btn" class="px-4 py-2 bg-red-600 text-white rounded-full hover:bg-red-700 icon-btn">${translations[currentLang].clear_cart}</button>
                            <button id="checkout-btn" class="px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 icon-btn" disabled>${translations[currentLang].checkout}</button>
                        </div>
                    </div>
                </div>
            `;
            const cartContainer = document.getElementById('cart-items-container');
            const totalSpan = document.getElementById('cart-total-price');
            const checkoutBtn = document.getElementById('checkout-btn');
            const clearCartBtn = document.getElementById('clear-cart-btn');
            const backBtn = document.getElementById('back-from-cart-btn');
            if (!cartContainer) return;
            cartContainer.innerHTML = '';
            if (totalSpan) totalSpan.textContent = "0 DA";
            try {
                if (checkoutBtn) {
                    checkoutBtn.addEventListener('click', () => showMessage("La page de paiement sera bientôt disponible!", 3000, "info"));
                }
                if (clearCartBtn) {
                    clearCartBtn.addEventListener('click', async () => {
                        if (!currentUser) return;
                        userCart = {};
                        await db.doc(`users/${currentUser.uid}`).set({ cart: userCart }, { merge: true });
                        showMessage("Panier vidé!", 3000, "success");
                        renderView('cart');
                    });
                }
                if (backBtn) backBtn.addEventListener('click', () => renderView('home'));
                if (!currentUser || Object.keys(userCart).length === 0) {
                    cartContainer.innerHTML = `<p class="text-center text-gray-500">${translations[currentLang].your_cart_is_empty}</p>`;
                    if (checkoutBtn) checkoutBtn.disabled = true;
                    return;
                }
                let total = 0;
                const productIds = Object.keys(userCart);
                const productsInCart = allProducts.filter(p => p && productIds.includes(p.id));
                productsInCart.forEach(product => {
                    if (!product) return;
                    const item = userCart[product.id];
                    const itemTotal = product.price * item.quantity;
                    total += itemTotal;
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4 p-4 border-b border-gray-200';
                    cartItemEl.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.title}" class="w-24 h-24 object-cover rounded-lg" loading="lazy" srcset="${product.imageUrl} 600w, ${product.imageUrl.replace('600x400', '300x200')} 300w" sizes="(max-width: 600px) 300px, 600px" onerror="this.src='https://placehold.co/300x200/E2E8F0/4A5568?text=Image+Indisponible';" />
                        <div class="flex-1">
                            <h4 class="font-semibold">${product.title}</h4>
                            <p class="text-gray-500">${product.price.toLocaleString()} DA</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span data-i18n-key="quantity">${translations[currentLang].quantity}:</span>
                            <input type="number" min="1" max="10" value="${item.quantity}" class="w-16 text-center border rounded-md text-lg" data-product-id="${product.id}">
                        </div>
                        <p class="font-semibold"><span data-i18n-key="item_total">${translations[currentLang].item_total}</span>: ${itemTotal.toLocaleString()} DA</p>
                        <button class="text-red-500 hover:text-red-700 remove-from-cart-btn icon-btn" data-product-id="${product.id}">
                            <i class="fas fa-trash"></i> <span data-i18n-key="remove">${translations[currentLang].remove}</span>
                        </button>
                    `;
                    cartContainer.appendChild(cartItemEl);
                });
                cartContainer.querySelectorAll('input[type="number"]').forEach(input => {
                    input.addEventListener('change', (e) => {
                        let value = parseInt(e.target.value);
                        if (value > 10) value = 10;
                        if (value < 1) value = 1;
                        e.target.value = value;
                        updateCartItem(e.target.dataset.productId, value);
                    });
                });
                cartContainer.querySelectorAll('.remove-from-cart-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        removeFromCart(e.currentTarget.dataset.productId);
                    });
                });
                if (totalSpan) totalSpan.textContent = `${total.toLocaleString()} DA`;
                if (checkoutBtn && total > 0) {
                    checkoutBtn.disabled = false;
                }
            } catch (error) {
                showMessage("Erreur lors du rendu du panier.", 3000, 'error');
                console.error("Cart page error:", error);
            }
            translatePage(currentLang);
        };
        const renderDashboardPage = async () => {
            if (!currentUser) {
                showMessage(translations[currentLang].login_required, 4000, 'error');
                renderView('home');
                return;
            }
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-6">${translations[currentLang].dashboard_link_mobile}</h2>
                    <div id="my-listings-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            `;
            const grid = document.getElementById('my-listings-grid');
            grid.innerHTML = `<p class="col-span-full text-center py-6 text-gray-600">Chargement de vos annonces...</p>`;
            try {
                db.collection("products").where("sellerUid", "==", currentUser.uid).onSnapshot(snapshot => {
                    const userProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    grid.innerHTML = "";
                    if (userProducts.length === 0) {
                        grid.innerHTML = `<p class="col-span-full text-center py-6 text-gray-500">Vous n'avez aucune annonce active.</p>`;
                        return;
                    }
                    userProducts.forEach(item => {
                        const conditionBadge = item.condition === 'new' ? `<span class="absolute top-2 right-2 bg-green-100 text-green-800 px-2 py-1 rounded">${translations[currentLang].new}</span>` : `<span class="absolute top-2 right-2 bg-yellow-100 text-yellow-800 px-2 py-1 rounded">${translations[currentLang].used}</span>`;
                        const card = document.createElement('div');
                        card.className = "bg-white rounded-lg shadow-md overflow-hidden flex flex-col min-h-[200px]";
                        card.innerHTML = `
                            <div class="relative">
                                <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-40 object-cover" loading="lazy" srcset="${item.imageUrl} 600w, ${item.imageUrl.replace('600x400', '300x200')} 300w" sizes="(max-width: 600px) 300px, 600px" onerror="this.src='https://placehold.co/300x200/E2E8F0/4A5568?text=Image+Indisponible';" />
                                ${conditionBadge}
                            </div>
                            <div class="p-4 flex-1 flex flex-col">
                                <h4 class="font-semibold">${item.title}</h4>
                                <p class="text-gray-600 font-bold mt-2">${item.price.toLocaleString()} DA</p>
                                <div class="mt-4 pt-4 border-t flex space-x-2 text-sm">
                                    <button class="flex-1 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 edit-btn icon-btn">Modifier</button>
                                    <button class="flex-1 bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 sold-btn icon-btn">Vendu</button>
                                    <button class="flex-1 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 delete-btn icon-btn" data-id="${item.id}">Supprimer</button>
                                </div>
                            </div>
                        `;
                        card.querySelector('.edit-btn').addEventListener('click', () => showMessage("La modification sera bientôt disponible.", 3000, "info"));
                        card.querySelector('.sold-btn').addEventListener('click', () => showMessage("Le marquage 'vendu' sera bientôt disponible.", 3000, "info"));
                        card.querySelector('.delete-btn').addEventListener('click', async (e) => {
                            const productId = e.currentTarget.dataset.id;
                            if (confirm("Êtes-vous sûr de vouloir supprimer cette annonce?")) {
                                try {
                                    await db.doc(`products/${productId}`).delete();
                                    showMessage("Annonce supprimée avec succès.", 3000, "success");
                                    renderView('dashboard');
                                } catch (error) {
                                    showMessage("Erreur lors de la suppression.", 3000, 'error');
                                    console.error("Delete error:", error);
                                }
                            }
                        });
                        grid.appendChild(card);
                    });
                });
            } catch (error) {
                showMessage("Erreur lors du chargement des annonces.", 3000, 'error');
                console.error("Dashboard error:", error);
            }
        };
        const renderProfilePage = async (data) => {
            if (!data || !data.userId) {
                renderView('home');
                return;
            }
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-6"><span id="profile-name">${data.userName || "Vendeur"}</span></h2>
                    <textarea id="profile-bio" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 product-description" placeholder="Ajouter une bio..."></textarea>
                    <button id="save-bio-btn" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 icon-btn">Enregistrer la bio</button>
                    <div id="user-products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-6"></div>
                </div>
            `;
            const grid = document.getElementById('user-products-grid');
            grid.innerHTML = `<p class="col-span-full text-center py-6 text-gray-600">Chargement des annonces...</p>`;
            try {
                const userDoc = await db.doc(`users/${data.userId}`).get();
                if (userDoc.exists && userDoc.data().bio) {
                    document.getElementById('profile-bio').value = userDoc.data().bio;
                }
                db.collection("products").where("sellerUid", "==", data.userId).onSnapshot(snapshot => {
                    const userProducts = snapshot.docs.map
